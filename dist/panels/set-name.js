'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const fs_1 = require("fs");
const vue_1 = require("vue");
const short_name_1 = require("../short-name");
// 根据分类拆分shortNames
function categorizeShortNames(shortNames) {
    const categories = {
        uiComponents: {},
        mediaComponents: {},
        renderComponents: {},
        animationComponents: {},
        otherComponents: {}
    };
    // UI组件 (index 0-13)
    const keys = Object.keys(shortNames);
    keys.slice(0, 14).forEach(key => {
        categories.uiComponents[key] = shortNames[key];
    });
    // 多媒体组件 (index 14-17)
    keys.slice(14, 18).forEach(key => {
        categories.mediaComponents[key] = shortNames[key];
    });
    // 渲染相关 (index 18-22)
    keys.slice(18, 23).forEach(key => {
        categories.renderComponents[key] = shortNames[key];
    });
    // 动画相关 (index 23-26)
    keys.slice(23, 27).forEach(key => {
        categories.animationComponents[key] = shortNames[key];
    });
    // 其他 (index 27+)
    keys.slice(27).forEach(key => {
        categories.otherComponents[key] = shortNames[key];
    });
    return categories;
}
let uuidSelected = "";
const options = {
    listeners: {},
    style: (0, fs_1.readFileSync)((0, path_1.join)(__dirname, '../../static/style/set-name/style.css'), 'utf-8'),
    template: (0, fs_1.readFileSync)((0, path_1.join)(__dirname, '../../static/template/set-name/index.html'), 'utf-8'),
    $: {
        app: "#app" // 指定一个ID选择器，确保HTML模板中有对应的元素
    },
    methods: {},
    async ready() {
        const uuid = arguments[0];
        if (!uuid) {
            await Editor.Panel.close('game-framework.set-name');
            Editor.Dialog.error('请选择一个节点');
            return;
        }
        uuidSelected = uuid;
        // 获取组件分类
        const categories = categorizeShortNames(short_name_1.shortNames);
        // 创建Vue应用
        const app = (0, vue_1.createApp)({
            // 使用内联模板
            data() {
                return {
                    selectedType: '',
                    customName: '',
                    uiComponents: categories.uiComponents,
                    mediaComponents: categories.mediaComponents,
                    renderComponents: categories.renderComponents,
                    animationComponents: categories.animationComponents,
                    otherComponents: categories.otherComponents,
                    allComponents: short_name_1.shortNames
                };
            },
            methods: {
                updateType(event) {
                    this.selectedType = event.target.value;
                },
                updateName(event) {
                    this.customName = event.target.value;
                },
                confirm() {
                    if (this.selectedType) {
                        // 组合名称
                        const fullName = `_${this.selectedType}${this.customName}`;
                        // 发送事件
                        Editor.Message.request("scene", "set-property", {
                            uuid: uuidSelected,
                            path: "name",
                            dump: {
                                type: "string",
                                value: fullName
                            }
                        });
                        // 关闭面板
                        Editor.Panel.close('game-framework.set-name');
                    }
                    else {
                        Editor.Dialog.warn('请选择一个组件类型');
                    }
                },
                cancel() {
                    Editor.Panel.close('game-framework.set-name');
                }
            },
            created() {
                // 默认选中第一个UI组件
                if (Object.keys(this.uiComponents).length > 0) {
                    this.selectedType = Object.keys(this.uiComponents)[0];
                }
            }
        });
        app.config.compilerOptions.isCustomElement = (tag) => tag.startsWith('ui-');
        // 挂载Vue应用到DOM
        app.mount(this.$.app);
    },
    async beforeClose() {
        // 面板关闭前的处理
    },
    close() {
        // 面板关闭后的处理
    },
};
module.exports = Editor.Panel.define(options);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0LW5hbWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvcGFuZWxzL3NldC1uYW1lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFDYiwrQkFBNEI7QUFDNUIsMkJBQWtDO0FBQ2xDLDZCQUFnQztBQUNoQyw4Q0FBMkM7QUFnQjNDLG1CQUFtQjtBQUNuQixTQUFTLG9CQUFvQixDQUFDLFVBQXdCO0lBQ2xELE1BQU0sVUFBVSxHQUF1QjtRQUNuQyxZQUFZLEVBQUUsRUFBRTtRQUNoQixlQUFlLEVBQUUsRUFBRTtRQUNuQixnQkFBZ0IsRUFBRSxFQUFFO1FBQ3BCLG1CQUFtQixFQUFFLEVBQUU7UUFDdkIsZUFBZSxFQUFFLEVBQUU7S0FDdEIsQ0FBQztJQUVGLG9CQUFvQjtJQUNwQixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3JDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUM1QixVQUFVLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNuRCxDQUFDLENBQUMsQ0FBQztJQUVILHNCQUFzQjtJQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDN0IsVUFBVSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxxQkFBcUI7SUFDckIsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQzdCLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENB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clxuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7XHJcbmltcG9ydCB7IGNyZWF0ZUFwcCB9IGZyb20gJ3Z1ZSc7XHJcbmltcG9ydCB7IHNob3J0TmFtZXMgfSBmcm9tICcuLi9zaG9ydC1uYW1lJztcclxuXHJcbi8vIOWumuS5iee7hOS7tuexu+Wei+aOpeWPo1xyXG5pbnRlcmZhY2UgU2hvcnROYW1lTWFwIHtcclxuICAgIFtrZXk6IHN0cmluZ106IHN0cmluZztcclxufVxyXG5cclxuLy8g5YiG57G75ZCO55qE57uE5Lu25o6l5Y+jXHJcbmludGVyZmFjZSBDYXRlZ29yeUNvbXBvbmVudHMge1xyXG4gICAgdWlDb21wb25lbnRzOiBTaG9ydE5hbWVNYXA7XHJcbiAgICBtZWRpYUNvbXBvbmVudHM6IFNob3J0TmFtZU1hcDtcclxuICAgIHJlbmRlckNvbXBvbmVudHM6IFNob3J0TmFtZU1hcDtcclxuICAgIGFuaW1hdGlvbkNvbXBvbmVudHM6IFNob3J0TmFtZU1hcDtcclxuICAgIG90aGVyQ29tcG9uZW50czogU2hvcnROYW1lTWFwO1xyXG59XHJcblxyXG4vLyDmoLnmja7liIbnsbvmi4bliIZzaG9ydE5hbWVzXHJcbmZ1bmN0aW9uIGNhdGVnb3JpemVTaG9ydE5hbWVzKHNob3J0TmFtZXM6IFNob3J0TmFtZU1hcCk6IENhdGVnb3J5Q29tcG9uZW50cyB7XHJcbiAgICBjb25zdCBjYXRlZ29yaWVzOiBDYXRlZ29yeUNvbXBvbmVudHMgPSB7XHJcbiAgICAgICAgdWlDb21wb25lbnRzOiB7fSxcclxuICAgICAgICBtZWRpYUNvbXBvbmVudHM6IHt9LFxyXG4gICAgICAgIHJlbmRlckNvbXBvbmVudHM6IHt9LFxyXG4gICAgICAgIGFuaW1hdGlvbkNvbXBvbmVudHM6IHt9LFxyXG4gICAgICAgIG90aGVyQ29tcG9uZW50czoge31cclxuICAgIH07XHJcblxyXG4gICAgLy8gVUnnu4Tku7YgKGluZGV4IDAtMTMpXHJcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoc2hvcnROYW1lcyk7XHJcbiAgICBrZXlzLnNsaWNlKDAsIDE0KS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgY2F0ZWdvcmllcy51aUNvbXBvbmVudHNba2V5XSA9IHNob3J0TmFtZXNba2V5XTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOWkmuWqkuS9k+e7hOS7tiAoaW5kZXggMTQtMTcpXHJcbiAgICBrZXlzLnNsaWNlKDE0LCAxOCkuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgIGNhdGVnb3JpZXMubWVkaWFDb21wb25lbnRzW2tleV0gPSBzaG9ydE5hbWVzW2tleV07XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyDmuLLmn5Pnm7jlhbMgKGluZGV4IDE4LTIyKVxyXG4gICAga2V5cy5zbGljZSgxOCwgMjMpLmZvckVhY2goa2V5ID0+IHtcclxuICAgICAgICBjYXRlZ29yaWVzLnJlbmRlckNvbXBvbmVudHNba2V5XSA9IHNob3J0TmFtZXNba2V5XTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIOWKqOeUu+ebuOWFsyAoaW5kZXggMjMtMjYpXHJcbiAgICBrZXlzLnNsaWNlKDIzLCAyNykuZm9yRWFjaChrZXkgPT4ge1xyXG4gICAgICAgIGNhdGVnb3JpZXMuYW5pbWF0aW9uQ29tcG9uZW50c1trZXldID0gc2hvcnROYW1lc1trZXldO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8g5YW25LuWIChpbmRleCAyNyspXHJcbiAgICBrZXlzLnNsaWNlKDI3KS5mb3JFYWNoKGtleSA9PiB7XHJcbiAgICAgICAgY2F0ZWdvcmllcy5vdGhlckNvbXBvbmVudHNba2V5XSA9IHNob3J0TmFtZXNba2V5XTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBjYXRlZ29yaWVzO1xyXG59XHJcblxyXG5sZXQgdXVpZFNlbGVjdGVkID0gXCJcIjtcclxuY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgIGxpc3RlbmVyczoge30sXHJcbiAgICBzdHlsZTogcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnLi4vLi4vc3RhdGljL3N0eWxlL3NldC1uYW1lL3N0eWxlLmNzcycpLCAndXRmLTgnKSxcclxuICAgIHRlbXBsYXRlOiByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICcuLi8uLi9zdGF0aWMvdGVtcGxhdGUvc2V0LW5hbWUvaW5kZXguaHRtbCcpLCAndXRmLTgnKSxcclxuICAgICQ6IHtcclxuICAgICAgIGFwcDogXCIjYXBwXCIgLy8g5oyH5a6a5LiA5LiqSUTpgInmi6nlmajvvIznoa7kv51IVE1M5qih5p2/5Lit5pyJ5a+55bqU55qE5YWD57SgXHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIFxyXG4gICAgfSxcclxuICAgIGFzeW5jIHJlYWR5KCkge1xyXG5cclxuICAgICAgICBjb25zdCB1dWlkID0gYXJndW1lbnRzWzBdO1xyXG4gICAgICAgIGlmICghdXVpZCkge1xyXG4gICAgICAgICAgICBhd2FpdCBFZGl0b3IuUGFuZWwuY2xvc2UoJ2dhbWUtZnJhbWV3b3JrLnNldC1uYW1lJyk7XHJcbiAgICAgICAgICAgIEVkaXRvci5EaWFsb2cuZXJyb3IoJ+ivt+mAieaLqeS4gOS4quiKgueCuScpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB1dWlkU2VsZWN0ZWQgPSB1dWlkO1xyXG5cclxuICAgICAgICAvLyDojrflj5bnu4Tku7bliIbnsbtcclxuICAgICAgICBjb25zdCBjYXRlZ29yaWVzID0gY2F0ZWdvcml6ZVNob3J0TmFtZXMoc2hvcnROYW1lcyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g5Yib5bu6VnVl5bqU55SoXHJcbiAgICAgICAgY29uc3QgYXBwID0gY3JlYXRlQXBwKHtcclxuICAgICAgICAgICAgLy8g5L2/55So5YaF6IGU5qih5p2/XHJcbiAgICAgICAgICAgIGRhdGEoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVHlwZTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tTmFtZTogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgdWlDb21wb25lbnRzOiBjYXRlZ29yaWVzLnVpQ29tcG9uZW50cyxcclxuICAgICAgICAgICAgICAgICAgICBtZWRpYUNvbXBvbmVudHM6IGNhdGVnb3JpZXMubWVkaWFDb21wb25lbnRzLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlckNvbXBvbmVudHM6IGNhdGVnb3JpZXMucmVuZGVyQ29tcG9uZW50cyxcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25Db21wb25lbnRzOiBjYXRlZ29yaWVzLmFuaW1hdGlvbkNvbXBvbmVudHMsXHJcbiAgICAgICAgICAgICAgICAgICAgb3RoZXJDb21wb25lbnRzOiBjYXRlZ29yaWVzLm90aGVyQ29tcG9uZW50cyxcclxuICAgICAgICAgICAgICAgICAgICBhbGxDb21wb25lbnRzOiBzaG9ydE5hbWVzXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVUeXBlKGV2ZW50OiB7IHRhcmdldDogeyB2YWx1ZTogc3RyaW5nIH0gfSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRUeXBlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHVwZGF0ZU5hbWUoZXZlbnQ6IHsgdGFyZ2V0OiB7IHZhbHVlOiBzdHJpbmcgfSB9KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdXN0b21OYW1lID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNvbmZpcm0oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOe7hOWQiOWQjeensFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdWxsTmFtZSA9IGBfJHt0aGlzLnNlbGVjdGVkVHlwZX0ke3RoaXMuY3VzdG9tTmFtZX1gO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlj5HpgIHkuovku7ZcclxuICAgICAgICAgICAgICAgICAgICAgICAgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdChcInNjZW5lXCIsIFwic2V0LXByb3BlcnR5XCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV1aWQ6IHV1aWRTZWxlY3RlZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IFwibmFtZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVtcDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwic3RyaW5nXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bGxOYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlhbPpl63pnaLmnb9cclxuICAgICAgICAgICAgICAgICAgICAgICAgRWRpdG9yLlBhbmVsLmNsb3NlKCdnYW1lLWZyYW1ld29yay5zZXQtbmFtZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEVkaXRvci5EaWFsb2cud2Fybign6K+36YCJ5oup5LiA5Liq57uE5Lu257G75Z6LJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgICAgICAgICBFZGl0b3IuUGFuZWwuY2xvc2UoJ2dhbWUtZnJhbWV3b3JrLnNldC1uYW1lJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNyZWF0ZWQoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDpu5jorqTpgInkuK3nrKzkuIDkuKpVSee7hOS7tlxyXG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMudWlDb21wb25lbnRzKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZFR5cGUgPSBPYmplY3Qua2V5cyh0aGlzLnVpQ29tcG9uZW50cylbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBhcHAuY29uZmlnLmNvbXBpbGVyT3B0aW9ucy5pc0N1c3RvbUVsZW1lbnQgPSAodGFnKSA9PiB0YWcuc3RhcnRzV2l0aCgndWktJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g5oyC6L29VnVl5bqU55So5YiwRE9NXHJcbiAgICAgICAgYXBwLm1vdW50KHRoaXMuJC5hcHApO1xyXG4gICAgfSxcclxuICAgIGFzeW5jIGJlZm9yZUNsb3NlKCkge1xyXG4gICAgICAgIC8vIOmdouadv+WFs+mXreWJjeeahOWkhOeQhlxyXG4gICAgfSxcclxuICAgIGNsb3NlKCkge1xyXG4gICAgICAgIC8vIOmdouadv+WFs+mXreWQjueahOWkhOeQhlxyXG4gICAgfSxcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRWRpdG9yLlBhbmVsLmRlZmluZShvcHRpb25zKTtcclxuIl19